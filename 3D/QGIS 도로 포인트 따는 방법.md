# QGIS 도로 포인트 따는 방법

---

>

### 1. 레이어 추가 

1. shape 폴더의 `.shp` 파일 선택해 레이어에 추가 

### 2. 원하는 객체(이동경로 라인) 선택 

1. 해당 레이어 `오른쪽-> 속성 테이블 열기 -> 표현식으로 객체 선택`
2. 표현식 이용해 원하는 객체 필터링 
   1. 원하는 표현식 쿼리문처럼 작성 (표현식 선택창 보면 사용예시들 있음)
   2. 예시 : `LaneNo=1 and RoadNo=1 and LinkType=4`

### 3. 라인을 포인트로 변경 

1. 랜덤 포인트 버전
   1. `공간 처리 툴박스 -> random 검색 -> 라인 따라 랜덤 포인터 생성 선택 -> 포인트 수 입력 후 실행`
   2. 포인트 수는 해당 라인안에서 차량이 이동할 지점(point)의 수 이다. 
2. 일정 간격 포인트 버전
   1. `패널에서 오른쪽 마우스 -> 고급 타이징 툴바 켜기 -> 편집모드 켜기 -> 라인 선택 -> 선택한 객체 병합 클릭`
      1. 객체를 병합하는 이유는, 포인트 생성시 포인트 수를 설정하게 되는데, 이때 병합되어 있어야 수로 포인트를 얻을 수 있다. 
      2. 라인은 feature로 되어있는데, 여러 그룹의 feature로 나뉘어져 있고, 해당 feature를 단일화 해주는 작업이다. 
   2. QChainage 
      1. 라인을 따라 일정한 간격으로 point 객체 만들어주는 플러그인 
      2. `플러그인 설치 -> 라인 객체 선택 -> QChainage -> Advanced -> Divide Feature into -> 원하는 point 수 입력` 
3. 데이터 정렬 추출 
   1. 위 방법을 사용하더라도 원본 데이터를 추출했을 때, 정렬되지 않고 나올 수 있다. 
   2. 이때 사용할 수 있는 방법은 `공간 처리 툴 박스 -> 벡터 일반 -> 표현식으로 정렬 -> 표현식(정렬기준필드) 선택 -> 실행` 으로 해결할 수 있다. 
   3. 이렇게 하면 데이터 추출 시 정렬된 값으로 추출할 수 있다. 
   4. 단, 정렬 기준 필드가 있어야 하므로 뒤에 나오는 `4. 포인트 위경도 추가` 의 x,y 데이터를 이용해 정렬된 fid 를 추출 후 이용해야한다. 


### 4. 포인트 위경도 추가 

1. 처음 포인트 뽑아내면 위경도 데이터가 없다. 
2. `공간처리 툴 박스 -> x,y 필드를 레이어에 추가 ->  포인트 레이어 선택`

### 5. 정렬

1. 포인트를 위경도 기준으로 정렬해야 차량이 재대로 움직인다. 

2. `포인트 레이어 오른쪽 마우스 -> 속성 테이블 열기 -> 필드 계산기 -> 표현식 입력 -> 새 필드 생성 -> 산출 필드 이름 입력 -> 확인`

   ```js
   // 배열에서 y축값을 이용해 내림차순 정렬한 값을 새 필드에 넣어준다. 
   array_find
   (
   array_sort(array_agg(y),ascending:=false),y
   )
   
   // y값 오름차순 정렬
   array_find
   (
   array_sort(array_agg(y),ascending:=true),y
   )
   ```