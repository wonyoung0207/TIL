# 블로킹과 논블로킹 개념정리 

---

>블로킹과 논블로킹 개념정리 

## 블로킹 (Blocking I/O)

### 정의

1. **쓰레드 기반 동기방식(Blocking I/O)**
2. 데이터를 읽거나 쓸 때, 해당 작업이 완료되리 떄까지 프로그램이나 스레드가 대기하는 것을 뜻한다. ( 키보드 입력 및 파일 입출력 작업등이 이에 해당함 )
   1. 즉, 단일코어의 단일 쓰레드인 CPU가 있다고 가정하자. IO 가 일어나면 작업이 완료될 떄 까지 쓰레드는 대기상태가 된다. 이것은 CPU가 연산을 멈추고 다른 일을 하지 못한다는 것을 뜻하기도 한다. 
   2. CPU가 쉬고 있는데 다른일을 처리하지 않는일이 발생하여 문제가될 수 있다. 
3. 따라서 Blocking IO 는 I/O 작업이 수행되는 동안은 프로그램의 제어가 I/O 작업을 처리하는 시스템에 일시적으로 넘어가게 되어 다른 작업을 진행하지 못하고 대기하는 상태를 말한다. 

### 특징

1. 하나의 쓰레드가 request를 받으면 모든 처리가 완료될때까지 기다리다가 처리결과가 완료되면 다시 응답을 보냄
2. 기존 업무 처리가 완료되기 전에 또다른 request가 있으면 새로운 쓰레드가 업무를 처리함.
3. 동시 request가 많은 경우 **많은 쓰레드를 필요로 하게 된다** 
   1. 많은 쓰레드는 결국 서버 과부하를 초례할 수 있다. 

```C
#include <stdio.h>

int sum(int a, int b)
{
    return a + b;
}

int main()
{
   int result;
   result = sum(1, 2);           // 1
   printf("sum: %d\n", result);  // 2

   return 0;                     // 3
}
```

- sum() 연산이 끝날때까지 기다렸다가 다음줄인 printf() 를 실행해야한다. 

---

## 논블로킹 ( Non-Blocking I/O)

### 정의

- **단일쓰레드 이벤트 루프 기반 비동기방식( Non-Blocking I/O)**
- Blocking IO 현상을 해결하는 방법으로, IO 작업발생시 해당 작업의 완료를 기다리지 않고 다른 작업을 받아 진행된다. 
- 이렇게되면 CPU는 계속 일하는 상태가 되며 더 좋은 성능을 낼 수 있게 된다. 

### 장점

1. Non-Blocking IO 를 사용하면 코어 당 하나의 스레드를 갖는 모델로도 애플리케이션의 성능을 높일 수 있게된다. 
   1. 이렇게 하면  문맥교환( 스레드가 다 차서 진행 중이던 쓰레드를 멈추고 해당 쓰레드에 다음 작업을 하는 것 -> 하나의 쓰레드에서는 같은 작업을 하는것이 문맥교환을 피해 가장 효율적으로 작업할 수 있는 방법이다. ) 을 최소화 할 수 있다. 
2. **하나의 쓰레드**가 request를 받으면 바로 다음 처리에 요청을 보내놓고 다른 작업을 처리하다가 먼저 요청한 작업이 끝나면 **이벤트를 받아서 응답**을 보낸다.
3. 동시 request가 오더라도 처리가 완료될때까지 기다리지 않아도 되기 때문에 서버 부하가 적다.

4. 따라서 논블로킹의 장점인 **하나의 쓰레드로 진행**되어 서버 과부하를 줄일 수 있고 **비동기방식으로 진행**되 다음 작업을 빠르게 시작하고 작업이 끝나면 이벤트를 통해 작업이 끝났다는 것을 알고 응답을 보낸다. 

- ```java
  const fs = require('fs')
  
  fs.readFile('./hello.txt' /* 1 */, function (err, data) {
    console.log(data) // 3
  })
  
  console.log('Hello JavaScript') // 2
  ```
  
  - fs.readFile() 함수의 리턴을 기다리지 않고 다음줄인 console.log() 를 실행한다. 

### 단점

1. 읽기, 쓰기 , 테스트 및 디버깅이 어렵다. 
2. 코드 가독성이 떨어진다. 
   1. 콜백이 많아져서 
3. 다른 라이브러리나 프 레임워크 의존도를 높인다. 
   1. JDK도 가지고 있지만 많은 기능을 제공하지 않아 다른 라이브러리를 사용해야한다. 
   2. Netty, Vert.x, Webflux, etc 등 