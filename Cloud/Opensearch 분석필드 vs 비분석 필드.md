# 분석 필드 vs 비분석 필드

---

>

## 분석필드

##### 타입

1. `text`

##### 개념

1. 저장된 데이터를 검색하기 쉽게 처리하는 필드
2. 일반적으로 **`text` 타입으로 정의되어있는게 분석필드이다.** 

##### 특징

1. 토큰화
   1. 데이터를 단어 또는 구문 단위로 분해된다.
   2. 예를 들어, "Hello World!"는 "hello"와 "world"로 분해된다. 
2. 소문자화
   1. 일반적으로 모든 텍스트는 **소문자로 변환되어 저장 및 조회된다.** 
3. 불용어 제거
   1. 특정한 단어(예: "the", "is")는 검색에 필요하지 않으므로 제거될 수 있다.
4. 검색 최적화
   1. 사용자가 입력한 쿼리와 관련된 다양한 형태의 텍스트를 일치시키기 위해 데이터를 처리한다. 

##### 장점

1. 일부 text로 검색 가능 
2. `"New York City"`라는 텍스트가 있을때, 쿼리에 따라 `"New"`만 검색해도 `"New York City"` 문서를 찾을 수 있음.

##### 쿼리에 따른 접근 방식

1. 예를들어, `sn000 vvc0011` 인 text 를 검색한다면 쿼리에 따라 다르게 조회해야한다. 

2. `term` 쿼리 사용 

   1. 정확한 값을 조회할 때 사용하므로, 소문자인 정확한 조회 값을 넣어줘야 한다. 

   ```json
   {
     "term": {
       "id": "sn000 vvc0011"
     }
   }
   ```

3. `match` 쿼리 사용

   1. 포함된 모든 값 검색 
   2. 즉, **분석필드 텍스트인 "abc123" 가 있다면, "abc" 만 조회조건에 넣어도 검색된다.** 

   ```json
   {
     "match": {
       "id": "sn000"
     }
   }
   ```

4. `wildcard` 쿼리 사용

   1. 특정 패턴을 검색

   ```json
   {
     "wildcard": {
       "id": "sn000*"
     }
   }
   ```



## 비분석 필드

##### 타입

1. `keyword`

##### 개념

1. 전체 값을 그대로 저장하는 필드로, 분석 과정을 거치지 않는다. 
2. 일반적으로 `keyword` 타입으로 정의되어 조회시 keyword 로 조회해야한다. 

##### 특징

1. 정확한 일치
   1. **전체 값이 그대로 저장**되므로, **필드의 정확한 값**을 검색하는 데 사용됩니다.
   2. 즉, "ABcd" 를 조회하려면 
      1. **비분석 필드인 경우 "ABcd"로 조회할 수 있지만** 
      2. **분석 필드인 경우 "abcd"로 조회되기 때문에 "ABcd" 값이 조회되지 않는다.** 
2. 토큰화 없음
   1. 데이터를 분해하지 않으므로, 전체 문자열로 저장됩니다.
3. 소문자화 없음
   1. 저장된 값의 원래 형태가 유지됩니다.

## 분석필드 or 비분석필드 조회

1. 필요 이유 

   1. 쿼리로 데이터 조회시 Text값을 조회하려면 "분석 or 비분석 필드" 여부에 따라 **조회 결과가 달라진다.** 
   2. 왜냐하면, 분석 필드는 모두 소문자로 변경되어 "ABcd"가 조회조건인 경우 "abcd" 로 변경되어 조회되므로 조회되지 않는다.
   3. 반면, 비분석 필드는 "ABcd"로 조회되기 때문에 **정확한 텍스트 조회가 필요한 경우엔 "분석/비분석 필드" 여부가 중요하다.** 

2. 조회 쿼리 

   ```bash
   GET index_name/_mapping
   ```

3. 쿼리 결과

   ```json
   {
     "properties": {
       "id": {
         "type": "text"  // 분석된 필드
       },
       "id.keyword": {
         "type": "keyword"  // 비분석 필드
       },
         
     	// 다른 형태 ( 더 깔끔하게 사용가능 ) 
     	"id" : {
         "type" : "text",
         "fields" : {
           "keyword" : {
             "type" : "keyword",
             "ignore_above" : 256
           }
         }
       },
       "deviceId": {
         "type": "integer"
       }
     }
   }
   ```

4. 조회시 쿼리 

   ```js
   {
     "query": {
       "term": {
         "id.keyword": "ABcd" // 비분석 필드로 조회 (ABcd 로 조회됨)
       }
     	"term": {
         "id": "ABcd" // 분석 필드로 조회 (abcd 로 조회됨)
       }
     }
   }
   ```

   

