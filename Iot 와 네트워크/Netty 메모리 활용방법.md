# Netty 메모리 활용방법

---

>

## 정리

1. Netty는 직접 메모리를 사용해 GC와 독립적으로 개발자가 관리하게 된다. 
2. 직접 메모리로 관리하게 되면 데이터 복사 작업이 발생하지 않아 대용량 파일 처리에서 좋은 성능을 낸다. 

## 자동 메모리 (Automatic Memory)

1. 자바의 **힙 메모리(Heap Memory)**로, **JVM에서 관리**하는 메모리 영역이다. 

2. 자바 프로그램에서 **객체는 기본적으로 힙 메모리에 할당**된다. 

3. 이 메모리는 **GC(가비지 컬렉터)가 자동으로 관리**하므로, 프로그래머가 명시적으로 메모리를 해제할 필요가 없다.

   ```java
   ByteBuf buffer = Unpooled.buffer(1024); // Heap Memory 할당 -> GC가 관리 
   ```

## 직접 메모리 (Direct Memory)

1. **네이티브 메모리** 또는 **Off-Heap Memory**라고도 합니다. 

2. 메모리 관리 주체 

   1. **JVM내부가 아닌 외부의 힙 메모리**를 사용하여 **JVM의 가비지 컬렉터(GC)**와는 독립적으로 관리된다. 
   2. Netty는 네트워크 애플리케이션에서 높은 성능을 발휘하기 위해 이 메모리 유형을 주로 사용한다. 
   3. 직접 메모리는 **JVM 힙 메모리**가 아니기 때문에 **GC의 영향을 받지 않는다**.

3. 성능

   1. **JVM 외부 메모리**를 직접 사용하기 때문에 **메모리 복사**가 줄어들어 성능이 좋아진다. 

   ```java
   ByteBuffer buffer = ByteBuffer.allocateDirect(1024); // Direct Memory 할당 -> GC 관리 x
   ```

## Native 메모리

1. **JVM의 힙(Heap) 외부**에 존재하는 메모리이다. 
2. 메모리 관리 주체 
   1. 자바에서 "네이티브"라는 용어는 **JVM 밖의 메모리**를 의미하며, 이는 보통 **운영 체제(OS)**에서 직접 관리하는 메모리 영역을 가리킨다. 
   2. **직접 메모리**(`Direct Memory`)는 **네이티브 메모리**의 한 형태로, **JVM 밖의 메모리**를 효율적으로 사용하여 **I/O 성능**을 높이는 데 기여한다. 
3. **`ByteBuffer.allocateDirect()`**로 할당된 버퍼가 바로 **네이티브 메모리**에 속한다. 

## Netty 에서 Direct Memory vs Heap Memory 

| **특징**        | **Direct Memory (네이티브 메모리)** | **Heap Memory (자동 메모리)**     |
| --------------- | ----------------------------------- | --------------------------------- |
| **할당 메모리** | `Unpooled.directBuffer()` 사용      | `Unpooled.buffer()` 사용          |
| **메모리 관리** | 수동 해제 (명시적 해제 필요)        | GC가 자동 관리                    |
| **성능**        | 빠른 성능 (I/O, 네트워크)           | 상대적으로 느림                   |
| **장점**        | 고성능 I/O 작업에 최적화            | 간단한 사용, 자동 메모리 관리     |
| **단점**        | 명시적인 메모리 관리 필요           | 성능 저하 가능 (메모리 복사 발생) |