# [TCP/IP 송수신 과정]

<img src="./images/TCP_IP송수신 구조.jpg" width="1000">

##### 1. copy

1. 서버의 DB로부터 **원본 파일을 복제**한다. 
2. Program의 Buffer에 복제 파일을 넣는다. 

##### 2. send / Recive

1. 운영체제의 입출력을 하기 위해 **`Socket I/O의 Buffer`에 적제**한다. 

##### 3. 분해

1. `Buffer`에 **적제된 내용**을 잘게 **분해**한다. 
2. 이때 데이터 덩어리가 `Segment` 라는 조각으로 분해된다. 

##### 4. 포장

1. 분해된 **`Segment` 조각**을 네트워크 전송을 위해 **포장** 한다. 
2. 이때 포장된 **Segment 조각 하나를 Packet** 이라고 한다. 

##### 5. 운송

1. **하나의 `Packet`을 네트워크를 통해 `Frame`화 시켜 전송**한다. 
2. `Frame`은 유통과정(네트워크)에서 수시로 택배차를 갈아탄다. 
3. 이때 `Packet`은 순서대로 보내지며, 일정량을 보내고 나면 ACK 을 받을때까지 `wait` 상태로 대기한다. 
   1. 만약 수신측의 `여유공간(Window Size)` 이 없는경우에도 `wait` 상태로 전환되어 더이상 데이터를 전송하지 않는다. 


##### 6. 배송

1. 전송된 `Frame`을 받아 `Packet`의 형태로 전달받는다. 

##### 7. 포장해제 

1. 포장된 `packet` 안에있던 `segment` 를 꺼낸다. 
2. 여기서 Network 가 잘 받았다는 **ACK 신호를 송신측에 전송**한다. 
   1. 운영체제(L3) 에서 잘 받았다는 신호를 보낸다. 
   2. 이때 **`ACK + 여유공간`** 에 대한 정보를 전송한다.
   3. 예를들어, `ACK #3` 의 신호를 송신측으로 보내면 송신측은 `ACK #2` 까지의 데이터가 잘 갔다고 판단하고 3번 데이터부터 전송하는데, 이때 같이온 `여유공간` 정보를 토대로 `wait` 할것인지 `send` 할 것인지를 결정하게 된다. 
3. **Network 장애**
   1. 여기서 Network 에 대한 장애가 발생할 수 있다. 
   2. Loss ( 유실 )
      1. Frame 전송시 데이터가 유실되는 경우 발생
      2. 무조건 Network 상의 문제이다. 
   3. Re-Transmission
      1. 송신측으로 Ack 이 안오는 경우 발생
      2. Packet을 재전송 하게되는데, 이때도 `Ack-Duplication` 에러가 추가적으로 발생할 수 있다. 
      3. 무조건 Network 의 문제이다. 
   4. Out Of Order
      1. 패킷의 전송 순서가 잘못된 경우 발생 
      2. Network 문제 
      3. 예를들어, `3번이 안오고 4번이 도착한 경우` OR `4번이 오고 3번이 뒤늦게 온 경우` 
   5. Zero Window 
      1. Network 가 `Process 의 Buffer`를 비워내는 속도보다 빨라서 `I/O Buffer` 에 Full 이 일어난 경우
      2. 즉, 여유공간이 없어 송신측에서 데이터 보내도 처리 못하는 경우
      3. End-Point 의 App(Program) 문제

##### 8. 채움

1. 전송받은 `Segment` 를 Socket I/O 에 순차적으로 적제한다. 
2. I/O Buffer에는 계속 "**채움**" 이 일어나게 되는데, Network 성능에 따라 속도차가 생기게 되므로 항상 **여유공간** 을 계산하게 된다. 
3. **여유공간(Window Size)** 은 `I/O Buffer` 에서 관리되며, 일정량의 `Segment`가 조립되면 `Process Buffer` 로 올리게 된다. 
4. I/O Buf 에 쌓는것은 운영체제의 TCP 가 쌓아준다. 

##### 9. Read / Recive

1. `Program의 Buffer` 에 데이터를 적제한다. 
2. 해당 `Buffer`는 개발자가 용량을 정할 수 있다. 

##### 10. 비움 

1. `Process Buf` 에서는 계속해서 **비움** 이 일어난다
   1. "**비움**" 은 Program에 데이터를 사용하는 것을 뜻함