# Netty 데이터 레이스 문제 해결

---

>

## 데이터 레이스 문제 발생

1.  Netty를 이용해 websocket 연결 로직을 구현
   1. 실시간 차량 데이터를 websocket 을 이용해 받아오고 d3를 통해 데이터를 표출함
   2. 또한 서로 다른 지역의 차량 데이터를 하나의 websocket으로 받아와야함
2. 이때 프론트에서 websocket 을 이용해 Netty로 **다른 채널 데이터 전송 받는다고 한 직후 채널 전환 전 지역의 데이터가 소량 들어와 그려지는 문제** 발생
3. 정리 
   1. **WebSocket으로 채널을 전환 요청**한 직후,
   2. **Netty가 채널을 전환하기 전의 데이터**가 여전히 잠시 들어오고,
   3. D3가 그것을 잘못 그려버리는 상황.
   4. 따라서 실시간 데이터 타이밍 문제로 인해 이전 가비지 데이터가 남아져 그려짐 

## 생각한 방법

1. 프론트에서 WebSocket 연결을 끊고 다시 연결
   1. 전환 타이밍 명확
   2. 하지만 다수 사용자 이용시 Netty 서버 부하가 생길 수 있음 
   3. 적절한 방법 X 
2. 프론트 d3에서 지역 확인 후 필터링
   1. 로직 간단 
   2. "잘못된 데이터가 일시적으로라도 도착하는 걸 허용"한다는 점에서 본질적 해결은 아님
   3. 적절한 방법 X
3. 프론트에서 지역 전환 요청 후, 서버에서 먼저 "전환 완료 signal"을 보내고, 그 후 데이터 전송 **(전환 시그널 방식)**
   1. 채널 전환 시점이 **명확히 동기화**됨 (서버-프론트 양쪽).
   2. 클라이언트는 signal 수신 후 D3 초기화 → 그 이후 도착하는 데이터만 반영
   3. 적절한 방법 O

## 적용 방법 

1. 핸드쉐이크 처럼 signal 을 주고 받은 후 데이터 표출 

