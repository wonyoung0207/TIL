# [세가지 네트워크 장치 구조]

1. Inline
   1. 라우터
   2. 차단, 허용, 필터링 
2. Out Of Path
   1. 센서
   2. 패킷 
3. Proxy
   1. 소켓 스트림 수준의 File 
   2. 패킷을 조립하기엔 내용이 클 경우 사용 

## 1. Inline 구조

1. 형태
   1. 공유기, Router, IPS 
2. 데이터 단위 
   1. Packet 
3. 개념
   1. 네트워크 속도와 많은 연관이 있다. 

## 2. Out Of Path 구조 

1. 형태
   1. 센서 + Packet 수집장치 
   2. 수집장치
      1. L2 Port Mirroring
      2. Tab 스위치 (고성능 스위치)
2. 개념
   1. 분석 및 탐지 목적으로 사용한다. 
      1. 센서와 수집장치에 의해 스위치로 들어오는 내용들을 **Mirroring(복사) 해서 저장해놓는 구조**이다. 
   2. 센서는 청진기와 비슷하다고 생각하면 된다. 
      1. **센서의 역할은 Packet의 모든 내용을 Mirroring 해서 수집하고 분석하는 것이다.** 
      2. 즉, 수집장치는 도감청으로 이어질 수 있다. 
3. 예시
   1. ISP가 클라이언트의 Out Bound 를 모니터링하고 있다. 
   2. 이때 클라이언트의 Packet이 접속하려는 곳이 유해 사이트라면 ISP 에서 수집(Monitoring)하고 있다가 Sensor 서버가 해당 사이트를 감지하면 접속하려는 곳보다 더 빠른 속도로 클라이언트의 요청을 유해사이트 사이트로 처리 페이지로 이동시킨다. 
4. 망중립성의 원칙 (SPI 와 DPI)
   1. 따라서 우리나라는 SPI 를 통제할 수 있는 나라이다. 
   2. 하지만 DPI 를 실시하는 순간 도감청으로 본다. 

## 3. Proxy 구조

##### 형태

1. Proxy(Server) + Socket + Stream

##### 우회(외부 Proxy)

1. 외부 Proxy
   1. Proxy 서버를 이용해 우회하여 Web Server에 접속할 때 사용한다. 
2. 예시
   1. Proxy 서버를 이용해 **우회**하여 Web Server 에 요청을 보낸다. 
   2. 예를들어, 미국의 Web Server는 한국에서는 허용되지 않지만 독일은 허용한다. 
   3. 이때 미국 Web Server에 접속하기 위해선 한국에서 독일 Proxy를 이용해 우회한다면 접속이 가능해진다. 
3. 즉, IP 를 감추고 싶을때 Proxy가 많이 이용된다. 

##### 보호와 감시 (내부 Proxy)

1. 내부 Proxy 
   1. **내부 및 외부의 요청을 감시**할 때 사용한다. 
2. Proxy 와 IPS 관계
   1. **IPS의 역할은 단편화된 Packet 단위의 내용을 보고 Client를 보호**하는 것이다. 
      1. Proxy 서버또한 IPS와 같은 기능을 할 수 있다. 
   2. Proxy 서버는 **HTTP통신을 통해 감시**하기 때문에 File을 감시하는 측면에서 IPS보다 좋은 성능을 낼 수 있다. 

##### 서버 보호 (Reverse Proxy)

1. Reverse Proxy
   1. **서버 보호를 위해 여러계층의  Proxy 서버가 존재**하는 구조 
2. 예시 
   1. 클라이언트가 하나의 서버에 접속할 때 
   2. 클라이언트 요청은 Pakcet수준에서 IPS 를 이용해 암호화한다. 
   3. 이때 Server IP에 바로 요청하는 것이 아닌 Server 앞에 방화벽인 Proxy 서버에 요청을 보내게 된다. 
   4. Proxy는 겹겹이 Web Server를 보호하여 각각 SSL 역할, WAF 역할로써 동작한다. 

##### 로컬 암호화 분석 

1. Fiddler 
   1. 로컬단위에서 HTTPS를 분석하는 도구 
2. 예시
   1. 암호화 되어있는 HTTPS를 분석하기 위해 로컬 단위에 Fidder 라는 도구를 설치한다.
   2. Fiddler 는 Proccess로써 단편화가 일어나는 Packet(4계층)까지 내려가지 않고 Socket (Stream)단위에서 HTTPS 를 분석하게 된다. 
   3. 즉, Proxy Server 를 127.0.0.1로 설정하면 Fiddler 가 해당 HTTPS 신호를 검지하고 Fiddler 를 이용해 외부로 접속한다. 
   4. 이때 **Fiddler 는 HTTPS 를 Packet 단위가 아닌 Stream 단위에서 복호화해서 분석**하기 때문에 암호화 통신 분석에 매우 용이해진다. 

## 공유기 

##### IP 종류

1. Public
2. Private

##### NAT (Network Address Translation)

1. 네트워크 주소 변환을 뜻하며 일반적인 인터넷 공유기에 적용된 기술이다. 

##### 작동원리

1. 제어
   1. IP 주소와 포트번호를 모두 제어 
2. 주소할당
   1. 인터넷 IP주소 부족 문제를 Private, Public 주소로 나누어 해결한다. 
3. 보안성 
   1. 패킷 필터링 방화벽과 비슷한 보안성 제공 

##### 구조에 따른 분류 

1. Cone NAT
   1. Host 단위로 외부포트 지정
2. Symmetric NAT
   1. TCP 세션마다 외부 포트 지정
   2. 보안성이 뛰어나다. 