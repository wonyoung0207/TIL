

# DB이벤트 이용한 파티셔닝 프로시저 구현

---

>

## 구현 계기

- DB 이벤트 이용해 월말마다 파티셔닝을 하는 기능을 개발했엇다. 
- **하지만 에러로 인해 파티셔닝이 되지않아 데이터가 유실되었다.** 
  - 파티셔닝을 하기 위해선 pmax를 삭제 후 다음 파티셔닝을 추가해야하는 로직이 존재한다. 
  - 에러로 인해 pmax 에 데이터들이 쌓였다. (원래라면 파티셔닝된 곳에 데이터가 저장되고 pmax에는 데이터가 없어야 한다 )
  - 그 결과 pmax 가 삭제되어 데이터가 유실되었다. 
- 그래서 해당 기능을 보완하기 위해 구현 계획을 세웠다. 

## 구현 계획

1. Event 실행 (매일 새벽 3시 실행)
   - 말일인지 체크( 말일 아닌 경우 event 중지 )
   - 혹시 있을 pmax 데이터 누락 최소화 위해 새벽 3시 실행 
   - 실행 로그 기록 
2. 프로시저 실행 (말일인 경우)
   1. pmax 존재 여부 확인
      - 기존 pmax 분할
   2. 다음달 파티션 정보 계산
      1. 다음달 파티션 존재 여부 확인
      2. 다음달 파티션 추가
   3. pmax 다시 추가
      1. pmax 데이터 복원 (있을 경우)
   4. 종료 로그